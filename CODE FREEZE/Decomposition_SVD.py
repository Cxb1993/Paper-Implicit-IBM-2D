import sys
from scipy.linalg import eig as Eig
import scipy
from pylab import *
from numpy import *
import time
import math


M = 1
N = 256
h = 1. / N
h2 = h**2

NumTerms = 1
z = ones(2 * N * NumTerms)
f = ones(N * N)
F = zeros((N, N))
r = ones(N * N)

Phi64 = array([ 0.14892819,  0.13959485,  0.11969092,  0.10029712,  0.08424098,
        0.07127252,  0.06089629,  0.05249719,  0.04564117,  0.03997467,
        0.0352488 ,  0.03126958,  0.0278942 ,  0.02501028,  0.02253161,
        0.02038912,  0.01852816,  0.01690419,  0.01548118,  0.01422931,
        0.01312405,  0.01214487,  0.01127465,  0.01049892,  0.00980547,
        0.0091839 ,  0.00862536,  0.00812226,  0.00766807,  0.00725715,
        0.00688466,  0.00654636,  0.00623857,  0.00595809,  0.00570212,
        0.00546819,  0.00525415,  0.00505808,  0.00487832,  0.00471336,
        0.0045619 ,  0.00442276,  0.00429492,  0.00417744,  0.0040695 ,
        0.00397037,  0.00387939,  0.00379597,  0.0037196 ,  0.0036498 ,
        0.00358616,  0.00352831,  0.00347592,  0.00342868,  0.00338635,
        0.00334868,  0.00331549,  0.00328659,  0.00326184,  0.0032411 ,
        0.00322427,  0.00321127,  0.00320203,  0.00319651])

Phi256 = array([ 0.25710939,  0.2472572 ,  0.22593886,  0.20450935,  0.18601602,
        0.17035813,  0.15714294,  0.14582589,  0.13602297,  0.12741627,
        0.11978264,  0.11294661,  0.10677853,  0.10117524,  0.09605672,
        0.0913578 ,  0.087026  ,  0.08301761,  0.0792964 ,  0.07583161,
        0.07259721,  0.06957072,  0.06673277,  0.06406644,  0.06155695,
        0.0591912 ,  0.05695766,  0.054846  ,  0.05284703,  0.05095246,
        0.04915486,  0.04744748,  0.04582422,  0.0442795 ,  0.04280826,
        0.04140586,  0.04006804,  0.03879088,  0.03757079,  0.03640445,
        0.03528876,  0.0342209 ,  0.03319822,  0.03221826,  0.03127873,
        0.03037752,  0.02951262,  0.02868218,  0.02788447,  0.02711785,
        0.0263808 ,  0.02567189,  0.02498976,  0.02433315,  0.02370088,
        0.0230918 ,  0.02250487,  0.02193908,  0.02139349,  0.02086721,
        0.02035938,  0.01986921,  0.01939594,  0.01893885,  0.01849726,
        0.01807052,  0.01765802,  0.01725918,  0.01687344,  0.01650027,
        0.01613916,  0.01578965,  0.01545128,  0.01512361,  0.01480622,
        0.01449873,  0.01420076,  0.01391194,  0.01363194,  0.01336042,
        0.01309707,  0.0128416 ,  0.01259371,  0.01235314,  0.01211961,
        0.01189288,  0.01167271,  0.01145886,  0.01125112,  0.01104927,
        0.01085311,  0.01066245,  0.0104771 ,  0.01029687,  0.01012161,
        0.00995113,  0.00978529,  0.00962392,  0.0094669 ,  0.00931406,
        0.00916528,  0.00902043,  0.00887938,  0.00874201,  0.0086082 ,
        0.00847785,  0.00835084,  0.00822708,  0.00810646,  0.00798888,
        0.00787426,  0.0077625 ,  0.00765352,  0.00754724,  0.00744357,
        0.00734244,  0.00724377,  0.00714749,  0.00705354,  0.00696184,
        0.00687234,  0.00678496,  0.00669965,  0.00661635,  0.00653501,
        0.00645557,  0.00637797,  0.00630217,  0.00622811,  0.00615576,
        0.00608506,  0.00601597,  0.00594845,  0.00588245,  0.00581794,
        0.00575487,  0.00569322,  0.00563293,  0.00557398,  0.00551634,
        0.00545996,  0.00540482,  0.00535089,  0.00529814,  0.00524653,
        0.00519604,  0.00514664,  0.00509831,  0.00505102,  0.00500474,
        0.00495945,  0.00491513,  0.00487176,  0.0048293 ,  0.00478775,
        0.00474708,  0.00470726,  0.00466829,  0.00463013,  0.00459278,
        0.00455622,  0.00452042,  0.00448537,  0.00445106,  0.00441746,
        0.00438457,  0.00435237,  0.00432084,  0.00428996,  0.00425974,
        0.00423014,  0.00420117,  0.0041728 ,  0.00414502,  0.00411783,
        0.00409121,  0.00406514,  0.00403963,  0.00401465,  0.0039902 ,
        0.00396627,  0.00394284,  0.00391992,  0.00389748,  0.00387552,
        0.00385403,  0.00383301,  0.00381244,  0.00379232,  0.00377263,
        0.00375338,  0.00373455,  0.00371613,  0.00369813,  0.00368053,
        0.00366332,  0.00364651,  0.00363008,  0.00361402,  0.00359834,
        0.00358303,  0.00356807,  0.00355347,  0.00353922,  0.00352531,
        0.00351175,  0.00349852,  0.00348562,  0.00347304,  0.00346079,
        0.00344885,  0.00343723,  0.00342592,  0.00341491,  0.0034042 ,
        0.0033938 ,  0.00338368,  0.00337386,  0.00336433,  0.00335508,
        0.00334611,  0.00333742,  0.003329  ,  0.00332086,  0.00331299,
        0.00330539,  0.00329805,  0.00329097,  0.00328416,  0.0032776 ,
        0.0032713 ,  0.00326525,  0.00325946,  0.00325391,  0.00324862,
        0.00324357,  0.00323877,  0.00323421,  0.00322989,  0.00322582,
        0.00322198,  0.00321838,  0.00321502,  0.0032119 ,  0.00320901,
        0.00320635,  0.00320393,  0.00320175,  0.00319979,  0.00319807,
        0.00319657,  0.00319531,  0.00319428,  0.00319347,  0.0031929 ,
        0.00319256])

Phi = array([ 0.20247138,  0.19275348,  0.17180847,  0.15093361,  0.13312841,
        0.11825789,  0.1059042 ,  0.09550412,  0.08665915,  0.07904001,
        0.07241434,  0.06659921,  0.06145883,  0.05688494,  0.05279332,
        0.04911529,  0.04579548,  0.04278776,  0.04005393,  0.03756161,
        0.03528342,  0.03319585,  0.03127868,  0.02951435,  0.02788758,
        0.02638495,  0.0249947 ,  0.02370639,  0.0225108 ,  0.0213997 ,
        0.02036576,  0.01940241,  0.01850375,  0.01766449,  0.01687983,
        0.01614545,  0.01545744,  0.01481223,  0.0142066 ,  0.01363761,
        0.01310257,  0.01259903,  0.01212474,  0.01167766,  0.01125589,
        0.0108577 ,  0.01048151,  0.01012585,  0.00978936,  0.00947081,
        0.00916903,  0.00888298,  0.00861166,  0.00835416,  0.00810964,
        0.00787731,  0.00765644,  0.00744637,  0.00724646,  0.00705612,
        0.00687481,  0.00670203,  0.00653729,  0.00638015,  0.00623021,
        0.00608707,  0.00595038,  0.0058198 ,  0.005695  ,  0.0055757 ,
        0.00546161,  0.00535248,  0.00524805,  0.00514811,  0.00505243,
        0.00496082,  0.00487307,  0.00478901,  0.00470848,  0.00463131,
        0.00455735,  0.00448647,  0.00441852,  0.00435339,  0.00429096,
        0.0042311 ,  0.00417373,  0.00411873,  0.00406601,  0.0040155 ,
        0.00396709,  0.00392071,  0.00387629,  0.00383376,  0.00379305,
        0.00375409,  0.00371683,  0.0036812 ,  0.00364717,  0.00361467,
        0.00358365,  0.00355408,  0.00352591,  0.0034991 ,  0.00347362,
        0.00344942,  0.00342647,  0.00340475,  0.00338422,  0.00336485,
        0.00334662,  0.00332951,  0.00331349,  0.00329854,  0.00328464,
        0.00327178,  0.00325993,  0.00324909,  0.00323923,  0.00323035,
        0.00322244,  0.00321548,  0.00320946,  0.00320438,  0.00320024,
        0.00319702,  0.00319472,  0.00319335,  0.00319289,  0.00319335,
        0.00319472,  0.00319702,  0.00320024,  0.00320438,  0.00320946,
        0.00321548,  0.00322244,  0.00323035,  0.00323923,  0.00324909,
        0.00325993,  0.00327178,  0.00328464,  0.00329854,  0.00331349,
        0.00332951,  0.00334662,  0.00336485,  0.00338422,  0.00340475,
        0.00342647,  0.00344942,  0.00347362,  0.0034991 ,  0.00352591,
        0.00355408,  0.00358365,  0.00361467,  0.00364717,  0.0036812 ,
        0.00371683,  0.00375409,  0.00379305,  0.00383376,  0.00387629,
        0.00392071,  0.00396709,  0.0040155 ,  0.00406601,  0.00411873,
        0.00417373,  0.0042311 ,  0.00429096,  0.00435339,  0.00441852,
        0.00448647,  0.00455735,  0.00463131,  0.00470848,  0.00478901,
        0.00487307,  0.00496082,  0.00505243,  0.00514811,  0.00524805,
        0.00535248,  0.00546161,  0.0055757 ,  0.005695  ,  0.0058198 ,
        0.00595038,  0.00608707,  0.00623021,  0.00638015,  0.00653729,
        0.00670203,  0.00687481,  0.00705612,  0.00724646,  0.00744637,
        0.00765644,  0.00787731,  0.00810964,  0.00835416,  0.00861166,
        0.00888298,  0.00916903,  0.00947081,  0.00978936,  0.01012585,
        0.01048151,  0.0108577 ,  0.01125589,  0.01167766,  0.01212474,
        0.01259903,  0.01310257,  0.01363761,  0.0142066 ,  0.01481223,
        0.01545744,  0.01614545,  0.01687983,  0.01766449,  0.01850375,
        0.01940241,  0.02036576,  0.0213997 ,  0.0225108 ,  0.02370639,
        0.0249947 ,  0.02638495,  0.02788758,  0.02951435,  0.03127868,
        0.03319585,  0.03528342,  0.03756161,  0.04005393,  0.04278776,
        0.04579548,  0.04911529,  0.05279332,  0.05688494,  0.06145883,
        0.06659921,  0.07241434,  0.07904001,  0.08665915,  0.09550412,
        0.1059042 ,  0.11825789,  0.13312841,  0.15093361,  0.17180847,
        0.19275348])

level = 0
if level > 0:
    for i in range(level-2,-1,-1):
        Phi64[i] = -.25 * Phi64[i] + 1.25 * Phi64[i+1]

ff = 1 * f
for j in range(N):
    for k in range(N):
##        f[j + N * k] = cos(j) * sin(k) + cos(j)**2 + sin(k)**2 + cos(j**2) / (1 + abs(k)) + sin(3 * k) * cos(j**3)

        f[j + N * k] = Phi256[abs(j - k)]
##        f[j + N * k] = Phi[(j - k) % N]
##        f[j + N * k] = 1. / (1 * (j * h - k * h)**2 + .001)
##        f[j + N * k] = 1. / (1 * (j * h + k * h)**2 + .001)
##        f[j + N * k] = 1. / (cos(4*pi*(j * h - k * h))**2 + 1)

##        f[j + N * k] = 1. / (abs(j * h - k * h) + .001)
##        f[j + N * k] = 1. / (j * h + k * h + .001)
##        f[j + N * k] = 1. / (abs(j * h + k * h) + .001)        

##        f[j + N * k] = ((j * h - k * h)**2 + 0)**.5
##        f[j + N * k] = abs(j * h - k * h)        


##f /= dot(f, f)**.5

for j in range(N):
    for k in range(N):
        F[j, k] = f[j + N * k]


def EvalDecomp(z):
    val = zeros(N * N, float64)

    for j in range(N):
        for k in range(N):
            for l in range(NumTerms):
                val[j + k * N] += z[j + 2 * N * l] * z[k + N + 2 * N * l]

    return val


def EvalDecompToPlane(z):
    val = zeros((N, N), float64)

    for j in range(N):
        for k in range(N):
            for l in range(NumTerms):
                val[j, k] += z[j + 2 * N * l] * z[k + N + 2 * N * l]

    return val

def EvalMultiDecompToPlane(Z):
    w = 0 * F
    for l in range(M):
        W[l] = EvalDecompToPlane(Z[l])
        w += W[l]

    return w    

def L2Norm(F):
    return ((F**2).sum())**.5


U, s, V = svd(F)
